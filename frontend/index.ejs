<!doctype html>
<html lang="es" data-theme="default">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Galería</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
 <link rel="stylesheet" href="/styles.css">

</head>
<body>
  <header>
    <div class="brand">
      <img src="/imagen/klay.png" alt="Klay" class="logo-img header-logo">
    </div>
    <div class="controls">
      <button id="playMusic">▶ Música</button>
      <div class="theme">
        <label>Color principal:</label>
        <input type="color" id="colorPicker" value="#4f46e5">
        <button class="preset" data-color="#666666">Oscuro</button>
        <button class="preset" data-color="#ffffff">Claro</button>
        <button class="preset" data-color="#5b59a6">Azul</button>
        <button class="preset" data-color="#4a6d6b">Verde</button>
      </div>
    </div>
  </header>

  <nav class="tabs">
    <button class="tab active" data-category="" data-default="true">Galería <span class="tab-delete" title="Eliminar categoría">✕</span></button>
    <button class="tab" data-category="FOTOS" data-default="true">Fotos <span class="tab-delete" title="Eliminar categoría">✕</span></button>
    <button class="tab" data-category="RECUERDOS" data-default="true">Recuerdos <span class="tab-delete" title="Eliminar categoría">✕</span></button>
    <button id="addCategoryTabBtn" class="tab" title="Agregar categoría">+</button>
    <div id="addCategoryContainer" style="display:inline-block; margin-left:8px;"></div>
  </nav>

  <main>
    <section class="upload">
      <h2>Subir foto</h2>
      <form id="uploadForm">
        <input type="text" name="title" placeholder="Título" required>
        <textarea name="description" placeholder="Descripción"></textarea>
        <label>Fecha de la foto</label>
        <input type="date" name="date_taken" required>
        <label>Categoría</label>
        <div style="display:flex;gap:8px;align-items:center;">
          <select name="category" id="categorySelect" required>
            <option value="GALERIA">GALERIA</option>
            <option value="FOTOS">FOTOS</option>
            <option value="RECUERDOS">RECUERDOS</option>
          </select>
        </div>
        <input type="file" name="file" accept="image/*" required>
        <button type="submit">Subir</button>
      </form>
      <p class="hint">Nota: la música se reproduce cuando haces clic en “Música” por políticas de los navegadores.</p>
    </section>

    <section>
      <h2 id="listTitle">Todas las fotos</h2>
      <div id="gallery" class="grid"></div>
    </section>
  </main>

  <audio id="bgMusic" loop>
    <source src="music.mp3" type="audio/mpeg">
  </audio>

  <template id="cardTemplate">
    <div class="card">
      <img class="card-img" alt="">
      <div class="card-body">
        <h3 class="card-title"></h3>
        <p class="card-desc"></p>
        <p class="card-date"></p>
        <p class="card-cat"></p>
        <div class="card-actions">
          <button class="edit">Editar</button>
          <button class="delete">Eliminar</button>
        </div>
      </div>
    </div>
  </template>

  <div id="editModal" class="modal hidden">
    <div class="modal-content">
      <h3>Editar foto</h3>
      <form id="editForm">
        <input type="text" name="title" required>
        <textarea name="description"></textarea>
        <label>Fecha</label>
        <input type="date" name="date_taken" required>
        <label>Categoría</label>
        <select name="category" required>
          <option value="GALERIA">GALERIA</option>
          <option value="FOTOS">FOTOS</option>
          <option value="RECUERDOS">RECUERDOS</option>
        </select>
        <div class="modal-actions">
          <button type="submit">Guardar</button>
          <button type="button" id="closeModal">Cancelar</button>
        </div>
      </form>
    </div>
  </div>

  <!-- View modal: lightbox para ver la imagen completa -->
  <div id="viewModal" class="modal hidden" aria-hidden="true">
    <div class="modal-content view-modal-content">
      <button id="closeView" style="float:right;padding:6px 10px;border-radius:8px;">Cerrar</button>
      <img id="viewImage" src="" alt="" style="display:block;margin:12px auto; max-width:92vw; max-height:78vh; border-radius:8px;" />
      <h3 id="viewTitle" style="text-align:center;margin-top:8px;color:var(--muted);"></h3>
    </div>
  </div>

  <script>
    // Para pruebas locales usa el mismo origen; en deploy pon la URL de tu backend
    // Exponer en `window` evita redeclaraciones de `const` en app.js
    window.API_BASE = window.location.origin; // ej. http://localhost:8080
  </script>
  <script src="app.js"></script>
  <script src="music.js" defer></script>

  <!-- Music manager modal -->
  <div id="musicModal" class="modal hidden" aria-hidden="true">
    <div class="modal-content" style="max-width:720px;">
      <h3>Gestor de música</h3>
      <form id="musicForm">
        <div style="display:flex;gap:8px;flex-wrap:wrap;align-items:center;">
          <input type="text" name="title" placeholder="Título" required style="flex:1;min-width:160px;" />
          <input type="text" name="artist" placeholder="Artista" required style="flex:1;min-width:160px;" />
        </div>
        <div style="margin-top:10px;display:flex;gap:8px;align-items:center;">
          <input type="file" name="file" accept="audio/*" required />
          <button type="submit">Guardar</button>
          <button type="button" id="closeMusic">Cancelar</button>
        </div>
      </form>

      <h4 style="margin-top:18px;">Tus pistas</h4>
      <div id="musicList" style="display:flex;flex-direction:column;gap:8px;margin-top:8px;"></div>
    </div>
  </div>

  <!-- Footer -->
  <footer class="site-footer" role="contentinfo">
    <div class="footer-inner">
      <div class="footer-brand">
        <img src="/imagen/klay.png" alt="Klay-Up" class="footer-logo">
        <div class="footer-title">Klay-Up</div>
      </div>
      <div class="footer-links">
        <a href="mailto:contacto@klay-up.local" class="footer-link">Contacto</a>
        <a href="#" class="footer-link">Privacidad</a>
        <a href="#" class="footer-link">EL mismo elefanto</a>
      </div>
      <div class="footer-copy">© <span id="footerYear"></span> Klay-Up</div>
    </div>
  </footer>

  <script>
    // footer year dinámico
    try { document.getElementById('footerYear').textContent = new Date().getFullYear(); } catch(e){}
  </script>
</body>
</html>
